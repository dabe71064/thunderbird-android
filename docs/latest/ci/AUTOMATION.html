<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Release Automation - Thunderbird for Android - Developer Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Developer Documentation for the Thunderbird for Android project.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../assets/theme/last-changed.css">
        <link rel="stylesheet" href="../assets/theme/navigation.css">
        <link rel="stylesheet" href="../assets/theme/pagetoc.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Thunderbird for Android - Developer Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/thunderbird/thunderbird-android" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/thunderbird/thunderbird-android/edit/main/./ci/AUTOMATION.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="release-automation-setup"><a class="header" href="#release-automation-setup">Release Automation Setup</a></h1>
<p>Release automation is triggered by the workflow_dispatch event on the “Shippable Build &amp; Signing”
workflow. GitHub environments are used to set configuration variables and secrets for each
application and release type.</p>
<h2 id="automatic-setup"><a class="header" href="#automatic-setup">Automatic setup</a></h2>
<p>There is a script available for automatic setup, which is helpful if you want to replicate this on
your own repository for devlopment. Please see /scripts/ci/setup_release_automation.</p>
<p>You can run it using:</p>
<pre><code class="language-bash">python -m venv venv
source venv/bin/activate
pip install requests pynacl
cd .signing
python ../scripts/ci/setup_release_automation -r yourfork/thunderbird-android
</code></pre>
<p>You will need the following files:</p>
<ul>
<li>The signing keys with their default filenames</li>
<li>A matrix-account.json with the following keys:</li>
</ul>
<pre><code class="language-json">{
  "homeserver": "matrix-client.matrix.org",
  "room": "room id here",
  "token": "matrix token here",
  "userMap": {
    "github_username": "@matrix_id:mozilla.org"
  }
}
</code></pre>
<ul>
<li><code>play-store-account.json</code> with the service account json that will do the uploads</li>
<li><code>thunderbird-mobile-gh-releaser-bot.clientid.txt</code> as a simple file with the client ID of the releaser bot (you can skip this to use GitHub Actions as the user)</li>
<li><code>thunderbird-mobile-gh-releaser-bot.pem</code> with the private key of the releaser bot</li>
</ul>
<h2 id="build-environments"><a class="header" href="#build-environments">Build Environments</a></h2>
<p>Build environments determine the configuration for the respective release channel. The following are
available:</p>
<ul>
<li>thunderbird_beta</li>
<li>thunderbird_daily</li>
<li>thunderbird_release</li>
</ul>
<p>The following (non-sensitive) variables have been set:</p>
<ul>
<li>RELEASE_TYPE: daily | beta | release</li>
<li>MATRIX_INCLUDES: A JSON string to determine the packages to be built</li>
</ul>
<p>The following MATRIX_INCLUDES would build an apk and aab for Thunderbird, and an apk for K-9 Mail.</p>
<pre><code class="language-json">[
  { "appName": "thunderbird", "packageFormat": "apk", "packageFlavor": "foss" },
  {
    "appName": "thunderbird",
    "packageFormat": "bundle",
    "packageFlavor": "full"
  },
  { "appName": "k9mail", "packageFormat": "apk", "packageFlavor": "foss" }
]
</code></pre>
<p>The environments are locked to the respective branch they belong to.</p>
<h2 id="signing-environments"><a class="header" href="#signing-environments">Signing Environments</a></h2>
<p>These environments contain the secrets for signing. Their names follow this pattern:</p>
<pre><code class="language-text">&lt;appName&gt;_&lt;releaseType&gt;_&lt;packageFlavor&gt;
thunderbird_beta_full
thunderbird_beta_foss
k9mail_beta_foss
</code></pre>
<p>The following secrets are needed:</p>
<ul>
<li>SIGNING_KEY: The base64 encoded signing key, see https://github.com/noriban/sign-android-release for details</li>
<li>KEY_ALIAS: The alias of your signing key</li>
<li>KEY_PASSWORD: The private key password for your signing keystore</li>
<li>KEY_STORE_PASSWORD: The password to your signing keystore</li>
</ul>
<p>The environments are locked to the respective branch they belong to.</p>
<h2 id="publishing-hold-environment"><a class="header" href="#publishing-hold-environment">Publishing Hold Environment</a></h2>
<p>The “publish_hold” is shared by all application variants and is used by the “pre_publish” job.
It has no secrets or variables, but “Required Reviewers” is set to trusted team members who oversee releases. The
effect is that after package signing completes, the publishing jobs that depend on it will not run until released
manually.</p>
<p><img src="assets/publish_hold.png" alt="publish hold" /></p>
<h2 id="github-releases-environment"><a class="header" href="#github-releases-environment">Github Releases Environment</a></h2>
<p>This environment will create the github release. It uses <a href="https://github.com/actions/create-github-app-token" title="" target="_blank">actions/create-github-app-token</a>
to upload the release with limited permissions.</p>
<ul>
<li>RELEASER_APP_CLIENT_ID: Environment variable with the OAuth Client ID of the GitHub app</li>
<li>RELEASER_APP_PRIVATE_KEY: Secret with the private key of the app</li>
</ul>
<p>The releases environment is locked to the release, beta and main branches.</p>
<p>If you leave out the environment, the Github Actions user will be used.</p>
<h2 id="matrix-notify-environment"><a class="header" href="#matrix-notify-environment">Matrix Notify Environment</a></h2>
<p>This environment will notify about build updates. It requires the following keys:</p>
<ul>
<li>MATRIX_NOTIFY_TOKEN: The Matrix token of the user</li>
<li>MATRIX_NOTIFY_HOMESERVER: The homeserver for the account</li>
<li>MATRIX_NOTIFY_ROOM: The room id to notify in</li>
<li>MATRIX_NOTIFY_USER_MAP: A json object that maps github usernames to matrix ids</li>
</ul>
<p>If you leave out this environment, no notifications will be sent.</p>
<footer id="last-change">Last change: 2025-04-11, commit: <a href="https://github.com/thunderbird/thunderbird-android/commit/7a27f65">7a27f65</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../ci/RELEASE.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../ci/HISTORICAL_RELEASE.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../ci/RELEASE.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../ci/HISTORICAL_RELEASE.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../assets/theme/mermaid.min.js"></script>
        <script src="../assets/theme/mermaid-init.js"></script>
        <script src="../assets/theme/navigation.js"></script>
        <script src="../assets/theme/pagetoc.js"></script>


    </div>
    </body>
</html>
